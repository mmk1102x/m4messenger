<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - M4</title>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
    <style>
        /* --- UNIVERSAL THEME ENGINE --- */
        :root { 
            --bg: #ffffff; --text: #000; --panel: #f2f2f7; --hl: #007aff; --border: #d1d1d6; 
            --btn-red-bg: #ffeef0; --btn-red-text: #ff4d4f; --radius: 0px;
        }
        [data-theme="dark"] { --bg: #000; --text: #0f0; --panel: #1c1c1e; --hl: #0f0; --border: #333; }
        [data-theme="text"] { --bg: #000; --text: #fff; --panel: #000; --hl: #fff; --border: #fff; }
        [data-theme="coffee"] { --bg: #fdf6e3; --text: #5d4037; --panel: #eee8d5; --hl: #8d6e63; --border: #d3af86; }
        [data-theme="midnight"] { --bg: #00040a; --text: #5080ff; --panel: #000814; --hl: #5080ff; --border: #002244; }
        [data-theme="crimson"] { --bg: #1a0505; --text: #ff4d4d; --panel: #280a0a; --hl: #ff4d4d; --border: #411; }
        [data-theme="emerald"] { --bg: #06100c; --text: #2ecc71; --panel: #0a1a14; --hl: #2ecc71; --border: #143a2b; }
        [data-theme="amber"] { --bg: #0d0b00; --text: #ffbf00; --panel: #141100; --border: #443300; --hl: #ffbf00; }
        [data-theme="solarized"] { --bg: #002b36; --text: #839496; --panel: #073642; --hl: #268bd2; --border: #586e75; }
        [data-theme="blue"] { --bg: #001f3f; --text: #00e5ff; --panel: #001a33; --hl: #00e5ff; --border: #003366; }
        [data-theme="purple"] { --bg: #0f0a1e; --text: #bf5af2; --panel: #1a1233; --hl: #bf5af2; --border: #2d1e5e; }

        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: monospace; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0; 
            transition: 0.3s;
        }

        /* FLEXIBLE LAYOUT BOX */
        .box { 
            background: var(--panel); 
            padding: 40px; 
            border: 2px solid var(--border); 
            text-align: center; 
            width: 90%; 
            max-width: 500px; 
            border-radius: var(--radius);
        }

        h2 { font-weight: 900; letter-spacing: -1px; margin-bottom: 20px; }

        input { 
            width: 100%; 
            padding: 20px; 
            margin: 10px 0; 
            border: 2px solid var(--border); 
            background: var(--bg); 
            color: var(--text); 
            font-size: 1.4em; 
            box-sizing: border-box; 
            border-radius: 10px; 
            outline: none;
            font-family: inherit;
        }

        /* DYNAMIC BUTTON */
        button { 
            width: 100%; 
            padding: 18px; 
            background: var(--hl); 
            color: white; 
            border: none; 
            font-weight: bold; 
            font-size: 1.3em; 
            cursor: pointer; 
            border-radius: 10px;
            margin-top: 10px;
            transition: 0.2s;
        }
        button:hover { filter: brightness(1.2); }
        [data-theme="dark"] button, [data-theme="text"] button, [data-theme="emerald"] button { color: #000; }

        a { 
            color: var(--text); 
            text-decoration: none; 
            font-weight: bold; 
            border-bottom: 2px solid var(--hl); 
            padding: 5px 10px; 
            display: inline-block; 
            margin-top: 25px;
            opacity: 0.7;
        }
        a:hover { opacity: 1; background: var(--hl); color: #fff; }
    </style>
</head>
<body data-theme="light">
    <div class="box">
        <h2 id="r-title">REGISTER</h2>
        <input id="u" placeholder="User">
        <input id="p" type="password" placeholder="Pass">
        <button id="r-btn" onclick="register()">CREATE ACCOUNT</button>
        <p><a href="index.html" id="back-link">BACK TO MESH</a></p>
    </div>

    <script>
        // Console CLI support for subpages
        window.cmd = (c) => { 
            const themes = ['light','dark','text','blue','purple','crimson','emerald','midnight','coffee','solarized','amber'];
            if(themes.includes(c)) { 
                document.body.setAttribute('data-theme', c); 
                localStorage.setItem('m4_theme', c); 
                console.log("%c[M4-SYS] Theme updated to " + c, "color:cyan; font-weight:bold;");
            }
            if(c === 'rus' || c === 'eng') {
                localStorage.setItem('m4_lang', c === 'rus' ? 'ru' : 'en');
                location.reload();
            }
        };

        // Initialize Theme & Lang
        const savedTheme = localStorage.getItem('m4_theme') || 'light';
        document.body.setAttribute('data-theme', savedTheme);
        console.log("%c[M4-SYS] Register Module Active. Type cmd('theme_name') in console to style.", "color:var(--hl); font-weight:bold;");

        const lang = localStorage.getItem('m4_lang') || 'en';
        const trans = {
            ru: { title: "РЕГИСТРАЦИЯ", user: "Имя", pass: "Пароль", btn: "СОЗДАТЬ", back: "ВЕРНУТЬСЯ В СЕТЬ" },
            en: { title: "REGISTER", user: "Username", pass: "Password", btn: "CREATE ACCOUNT", back: "BACK TO MESH" }
        };
        const t = trans[lang] || trans.en;
        document.getElementById('r-title').innerText = t.title;
        document.getElementById('u').placeholder = t.user;
        document.getElementById('p').placeholder = t.pass;
        document.getElementById('r-btn').innerText = t.btn;
        document.getElementById('back-link').innerText = t.back;

        // Gun.js Logic
        function register() {
            const u = document.getElementById('u').value.trim();
            const p = document.getElementById('p').value;
            
            if(!u || !p) return alert("Fill all fields.");
            if(u.includes(' ')) return alert("Spaces are forbidden in handles.");

            const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
            gun.user().create(u, p, (ack) => {
                if(ack.err) {
                    alert(ack.err);
                } else {
                    alert("Account registered! Redirecting to login...");
                    window.location.href = "login.html";
                }
            });
        }
    </script>
</body>
</html>